<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Selamat Wisuda, Ataa ðŸŒ¸</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&family=Great+Vibes&display=swap" rel="stylesheet">

  <style>
    :root{
      --pink:#ffbfd6;
      --soft-pink:#ffdced;
      --purple:#8e6fb7;
      --light-blue:#bfe9ff;
      --card-bg:rgba(255,255,255,0.92);
      --glass: rgba(255,255,255,0.26);
      --radius:18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Poppins,system-ui,Arial; background: linear-gradient(180deg,var(--soft-pink), #f7f0ff 40%, #eef9ff 100%); -webkit-font-smoothing:antialiased;}

    /* watercolor floral backdrop (svg-like) */
    .watercolor{position:fixed; inset:0; pointer-events:none; z-index:0;}
    .container{min-height:100vh;display:flex;align-items:center;justify-content:center;position:relative;padding:24px;z-index:2}

    /* Card layout */
    .card{width:100%;max-width:980px;background:var(--card-bg);border-radius:24px;box-shadow:0 10px 30px rgba(120,80,140,0.12);padding:28px;backdrop-filter: blur(6px);}

    header{display:flex;gap:16px;align-items:center}
    .logo{display:flex;align-items:center;gap:10px}
    .logo .badge{width:56px;height:56px;border-radius:14px;background:linear-gradient(135deg,var(--purple),var(--pink));display:flex;align-items:center;justify-content:center;color:white;font-weight:700;font-family:'Great Vibes',cursive;font-size:24px}
    h1{margin:0;font-size:20px;color:#5a2d6b}

    /* Landing */
    .landing{display:grid;grid-template-columns:1fr;gap:18px;padding:30px}
    .input-row{display:flex;gap:12px;align-items:center}
    input[type=text]{flex:1;padding:14px 16px;border-radius:12px;border:1px solid rgba(120,100,150,0.12);font-size:16px}
    .btn{background:linear-gradient(90deg,var(--purple),var(--pink));color:white;padding:12px 18px;border-radius:12px;border:0;font-weight:600;cursor:pointer}
    .muted{color:#6a4b7f;font-size:14px}

    /* Home */
    .home{display:none;padding:20px;align-items:center;justify-content:center}
    .greeting{display:flex;gap:20px;flex-direction:column;align-items:center;text-align:center;padding:20px}
    .greeting h2{font-family:'Great Vibes',cursive;font-size:44px;margin:0;color:var(--purple)}
    .poem{max-width:760px;color:#4a2f5a;font-size:18px;line-height:1.6}

    /* Controls */
    .controls{display:flex;gap:12px;align-items:center;flex-wrap:wrap;justify-content:center;margin-top:12px}

    /* Upload / Preview */
    .uploader{display:flex;gap:12px;align-items:center;flex-wrap:wrap;justify-content:center;margin-top:18px}
    .thumb{width:160px;height:160px;border-radius:14px;overflow:hidden;background:linear-gradient(180deg,var(--light-blue),var(--soft-pink));display:flex;align-items:center;justify-content:center;border:1px dashed rgba(120,80,140,0.12)}
    .thumb img{width:100%;height:100%;object-fit:cover}

    /* downloadable card modal */
    .card-preview{margin-top:18px;display:flex;gap:18px;flex-direction:column;align-items:center}
    .download-btn{background:linear-gradient(90deg,#ff8fc0,#9b7adf);border:0;padding:12px 16px;border-radius:12px;color:white;font-weight:600;cursor:pointer}

    /* footer */
    footer{margin-top:18px;text-align:center;color:#6a4b7f}

    /* small screens */
    @media (max-width:600px){.greeting h2{font-size:32px}.thumb{width:120px;height:120px}}

    /* Confetti canvas sits on top z-index:1 */
    #confetti{position:fixed;inset:0;pointer-events:none;z-index:1}

    /* Simple fade/slide animations */
    .fade-in{animation:fade .9s ease both}
    @keyframes fade{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}

    /* small music control */
    .audio-controls{display:flex;gap:8px;align-items:center;background:var(--glass);padding:8px;border-radius:12px}

  </style>
</head>
<body>

  <!-- watercolor SVG (decorative) -->
  <svg class="watercolor" viewBox="0 0 1200 800" preserveAspectRatio="xMidYMid slice">
    <defs>
      <linearGradient id="g1" x1="0" x2="1"><stop offset="0" stop-color="#ffe0f4"/><stop offset="1" stop-color="#efedff"/></linearGradient>
    </defs>
    <g opacity="0.35">
      <ellipse cx="100" cy="120" rx="220" ry="120" fill="#f9e6ff"/>
      <ellipse cx="1100" cy="680" rx="420" ry="220" fill="#e7f6ff"/>
      <ellipse cx="950" cy="120" rx="260" ry="160" fill="#ffeaf2"/>
    </g>
    <!-- floral watercolor blobs -->
    <g opacity="0.28">
      <circle cx="160" cy="220" r="120" fill="#eed4ff"/>
      <circle cx="360" cy="80" r="90" fill="#ffd9ec"/>
      <circle cx="860" cy="420" r="160" fill="#dfe9ff"/>
    </g>
  </svg>

  <canvas id="confetti"></canvas>

  <div class="container">
    <div class="card">
      <header>
        <div class="logo">
          <div class="badge">A</div>
          <div>
            <h1>Selamat Wisuda, Ataa</h1>
            <div class="muted">Sebuah halaman ucapan personal yang manis & dreamy</div>
          </div>
        </div>
      </header>

      <!-- Landing -->
      <main class="landing fade-in" id="landing">
        <p style="font-size:16px;color:#5c3b77">Halo! Buat halaman ucapan personal untuk Ataa. Masukkan nama (atau biarkan 'Ataa') dan klik masuk.</p>
        <div class="input-row">
          <input id="nameInput" type="text" placeholder="Tulis nama... (contoh: Ataa)" value="Ataa" />
          <button class="btn" id="enterBtn">Masuk</button>
        </div>

        <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap">
          <div class="muted">Warna tema: Ungu â€¢ Pink â€¢ Biru muda â€¢ Watercolor â€¢ Bunga</div>
          <div style="margin-left:auto" class="muted">Durasi preview 30 detik â€¢ Responsif HP</div>
        </div>
      </main>

      <!-- Home -->
      <section class="home" id="home">
        <div class="greeting">
          <h2 id="heroName">Untuk: Ataa</h2>

          <div class="poem" id="poem">
            <!-- dynamic poem --></div>

          <div class="controls">
            <div class="audio-controls">
              <button id="playAudio" class="btn" style="padding:8px 12px;">Play</button>
              <label style="font-size:13px;color:#5b3b7a">Pilih lagu (opsional)</label>
              <input id="audioFile" type="file" accept="audio/*" style="display:inline-block" />
            </div>

            <div>
              <button id="backBtn" class="btn" style="background:transparent;border:1px solid rgba(120,80,140,0.12);color:var(--purple);">Kembali</button>
            </div>
          </div>

          <div class="uploader">
            <label class="muted">Unggah foto untuk dibuat jadi kartu ucapan:</label>
            <input id="photoFile" type="file" accept="image/*" />
            <div class="thumb" id="thumb">Preview</div>
          </div>

          <div class="card-preview">
            <canvas id="cardCanvas" width="1200" height="700" style="max-width:100%;border-radius:12px;box-shadow:0 10px 30px rgba(100,60,120,0.08);"></canvas>
            <div style="display:flex;gap:10px;align-items:center">
              <button id="downloadJpg" class="download-btn">Download sebagai JPG</button>
              <button id="resetPic" class="btn" style="background:transparent;border:1px solid rgba(120,80,140,0.12);color:var(--purple);">Reset Foto</button>
            </div>
          </div>
        </div>

        <footer>
          <small>Made with love âœ¨ â€” Customize colors, text, atau musik lewat kontrol di atas.</small>
        </footer>
      </section>

    </div>
  </div>

  <!-- Hidden audio element -->
  <audio id="bgAudio" loop></audio>

  <script>
    // ---------- Simple routing ----------
    const landing = document.getElementById('landing');
    const home = document.getElementById('home');
    const nameInput = document.getElementById('nameInput');
    const enterBtn = document.getElementById('enterBtn');
    const heroName = document.getElementById('heroName');
    const poemEl = document.getElementById('poem');
    const bgAudio = document.getElementById('bgAudio');
    const playAudio = document.getElementById('playAudio');
    const audioFile = document.getElementById('audioFile');

    // default poem text
    const poemTemplate = name => `\n\nSelamat wisuda, ${name} ðŸ’\n\nHari ini bukan sekadar akhir perjalanan,\ntapi awal dari mimpi-mimpi yang mulai terbang lebih tinggi.\n\nLangit tersenyum melihat langkahmu,\ndan setiap bunga bermekaran memanggil namamu dengan bangga.\n\nSemoga setiap langkahmu selalu dihiasi keberanian,\ncinta, dan kebahagiaan yang tak berujung.\n\nDunia menunggu sinar terbaik darimu,\ndan hari ini â€” semuanya dimulai dari senyum cantikmu. ðŸ’«\n`;

    function showHome(name){
      landing.style.display='none';
      home.style.display='flex';
      heroName.textContent = `Untuk: ${name}`;
      typePoem(poemTemplate(name));
      startConfetti();
    }

    enterBtn.addEventListener('click', ()=>{
      const name = nameInput.value.trim() || 'Ataa';
      showHome(name);
    });

    document.getElementById('backBtn').addEventListener('click', ()=>{
      home.style.display='none'; landing.style.display='grid'; stopConfetti();
    });

    // typing effect
    function typePoem(text){
      poemEl.textContent='';
      let i=0;
      const speed=16;
      function step(){
        if(i<text.length){
          poemEl.textContent += text.charAt(i);
          i++;
          setTimeout(step,speed);
        }
      }
      step();
    }

    // ---------- Audio handling ----------
    let audioLoaded=false;
    audioFile.addEventListener('change', (e)=>{
      const f = e.target.files[0];
      if(!f) return;
      const url = URL.createObjectURL(f);
      bgAudio.src = url;
      audioLoaded=true;
      bgAudio.play().catch(()=>{});
      playAudio.textContent='Pause';
    });

    playAudio.addEventListener('click', async ()=>{
      if(bgAudio.paused){
        try{ await bgAudio.play(); playAudio.textContent='Pause'; }catch(e){ console.log('autoplay blocked'); }
      }else{ bgAudio.pause(); playAudio.textContent='Play'; }
    });

    // ---------- Photo upload & card canvas ----------
    const photoFile = document.getElementById('photoFile');
    const thumb = document.getElementById('thumb');
    const cardCanvas = document.getElementById('cardCanvas');
    const ctx = cardCanvas.getContext('2d');
    let uploadedImage = null;

    // draw initial empty card
    function drawCard(name){
      // background watercolor
      const w = cardCanvas.width; const h = cardCanvas.height;
      ctx.clearRect(0,0,w,h);
      const grad = ctx.createLinearGradient(0,0,w,h);
      grad.addColorStop(0,'#fff8ff');
      grad.addColorStop(0.5,'#f6f1ff');
      grad.addColorStop(1,'#eef9ff');
      ctx.fillStyle = grad;
      roundRect(ctx,0,0,w,h,24);
      ctx.fill();
      
      // floral accent (simple)
      ctx.fillStyle = 'rgba(155,122,223,0.12)';
      ctx.beginPath(); ctx.ellipse(w-160,120,220,80,0,0,Math.PI*2); ctx.fill();
      ctx.fillStyle = 'rgba(255,200,230,0.12)'; ctx.beginPath(); ctx.ellipse(120,h-120,200,90,0,0,Math.PI*2); ctx.fill();

      // place image if available
      if(uploadedImage){
        const imgW = Math.min(520, w*0.45);
        const imgH = imgW * (uploadedImage.height/uploadedImage.width);
        const imgX = 80; const imgY = (h - imgH)/2;
        // rounded clip
        roundClip(ctx,imgX,imgY,imgW,imgH,18);
        ctx.drawImage(uploadedImage, imgX, imgY, imgW, imgH);
        ctx.restore();
      }

      // text area
      ctx.fillStyle = 'rgba(80,45,120,0.92)';
      ctx.font = '38px "Great Vibes", cursive';
      ctx.fillText(`Untuk: ${ (nameInput.value.trim() || 'Ataa') }`, uploadedImage? 640:120, 160);

      ctx.font = '20px Poppins, sans-serif';
      wrapText(ctx, getShortPoem((nameInput.value.trim()||'Ataa')), uploadedImage?640:120, 220, 440, 30);

      // small footer
      ctx.fillStyle = 'rgba(90,50,120,0.6)';
      ctx.font = '16px Poppins, sans-serif';
      ctx.fillText('Selamat Wisuda â€¢ Dibuat dengan cinta', w-360, h-40);
    }

    function getShortPoem(name){
      return `Hari ini bukan akhir, tapi awal dari mimpi yang mulai terbang.\nLangit tersenyum melihat langkahmu, ${name}.\nSemoga langkahmu selalu dihiasi keberanian dan cinta.`;
    }

    // draw placeholder
    drawCard('Ataa');

    photoFile.addEventListener('change', (e)=>{
      const f = e.target.files[0];
      if(!f) return;
      const reader = new FileReader();
      reader.onload = function(ev){
        const img = new Image();
        img.onload = ()=>{
          uploadedImage = img;
          // preview thumb
          thumb.innerHTML = '';
          const timg = document.createElement('img'); timg.src = ev.target.result; thumb.appendChild(timg);
          drawCard(nameInput.value.trim() || 'Ataa');
        };
        img.src = ev.target.result;
      };
      reader.readAsDataURL(f);
    });

    document.getElementById('resetPic').addEventListener('click', ()=>{
      uploadedImage = null; thumb.innerHTML = 'Preview'; drawCard(nameInput.value.trim() || 'Ataa');
    });

    document.getElementById('downloadJpg').addEventListener('click', ()=>{
      // redraw at high resolution, then download
      const tmpCanvas = document.createElement('canvas');
      tmpCanvas.width = 1800; tmpCanvas.height = 1050; // large
      const tctx = tmpCanvas.getContext('2d');
      // scale factor
      const sx = tmpCanvas.width / cardCanvas.width;
      tctx.scale(sx,sx);
      // draw using our draw function but temporarily swap contexts
      // easiest: draw the visible canvas into tmp
      tctx.drawImage(cardCanvas,0,0);
      const link = document.createElement('a');
      link.href = tmpCanvas.toDataURL('image/jpeg',0.92);
      link.download = `${(nameInput.value.trim()||'Ataa')}_wisuda_card.jpg`;
      link.click();
    });

    // utility functions for canvas drawing
    function roundRect(ctx,x,y,w,h,r){ ctx.beginPath(); ctx.moveTo(x+r,y); ctx.arcTo(x+w,y,x+w,y+h,r); ctx.arcTo(x+w,y+h,x,y+h,r); ctx.arcTo(x,y+h,x,y,r); ctx.arcTo(x,y,x+w,y,r); ctx.closePath(); }
    function roundClip(ctx,x,y,w,h,r){ ctx.save(); ctx.beginPath(); roundRect(ctx,x,y,w,h,r); ctx.clip(); }
    function wrapText(ctx, text, x, y, maxWidth, lineHeight){ const words = text.split(' '); let line=''; for(let n=0;n<words.length;n++){ const testLine = line + words[n] + ' '; const metrics = ctx.measureText(testLine); const testWidth = metrics.width; if(testWidth>maxWidth && n>0){ ctx.fillText(line, x, y); line = words[n] + ' '; y += lineHeight; }else{ line = testLine; } } ctx.fillText(line, x, y); }

    // ---------- Confetti Ribbons (simple canvas particles) ----------
    const confettiCanvas = document.getElementById('confetti');
    const confettiCtx = confettiCanvas.getContext('2d');
    let confettiParticles = [];
    let confettiRunning = false;

    function resizeConfetti(){ confettiCanvas.width = innerWidth; confettiCanvas.height = innerHeight; }
    addEventListener('resize', resizeConfetti); resizeConfetti();

    function rand(min,max){return Math.random()*(max-min)+min}
    function spawnParticle(){
      const w = rand(8,22); const h = rand(14,36);
      confettiParticles.push({
        x: rand(0,confettiCanvas.width),
        y: -50,
        vx: rand(-0.6,0.6),
        vy: rand(1.2,2.5),
        r: rand(0,Math.PI*2),
        vr: rand(-0.04,0.04),
        w, h,
        color: ['#9b7adf','#ff8fc0','#bfe9ff','#f9d7ff'][Math.floor(rand(0,4))],
        time:0
      });
    }

    function drawParticles(){
      confettiCtx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
      for(let i=confettiParticles.length-1;i>=0;i--){
        const p = confettiParticles[i];
        p.time += 1;
        p.x += p.vx; p.y += p.vy; p.r += p.vr;
        // tilt effect
        confettiCtx.save();
        confettiCtx.translate(p.x,p.y);
        confettiCtx.rotate(p.r);
        confettiCtx.fillStyle = p.color;
        // draw ribbon as thin rect with slight curve
        confettiCtx.fillRect(-p.w/2,-p.h/2,p.w,p.h);
        confettiCtx.restore();
        // remove when off screen
        if(p.y > confettiCanvas.height + 80) confettiParticles.splice(i,1);
      }
    }

    let confettiTicker = null;
    function startConfetti(){ if(confettiRunning) return; confettiRunning = true; confettiTicker = setInterval(()=>{ if(Math.random()<0.6) spawnParticle(); drawParticles(); }, 30); }
    function stopConfetti(){ confettiRunning=false; clearInterval(confettiTicker); confettiCtx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height); confettiParticles=[]; }

    // ---------- small polish: auto-play prompt for audio (user must interact) ----------
    // Play a short gentle built-in melody only if browser allows (many block autoplay) - we keep audio empty until user chooses.

    // ---------- small helpers ----------
    function preload(){ /* reserved for future */ }

    // ---------- initial note ----------
    // The page relies on user interaction to start audio (browsers disallow autoplay). Ask user to press Play.

  </script>
</body>
</html>
