<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#ffdced">
  <title>Selamat Wisuda, Ataa 🌸</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&family=Great+Vibes&display=swap" rel="stylesheet">

  <style>
    :root {
      --pink: #ffbfd6;
      --soft-pink: #ffdced;
      --purple: #8e6fb7;
      --light-blue: #bfe9ff;
      --dark-purple: #5a2d6b;
      --text-color: #4a2f5a;
      --card-bg: rgba(255, 255, 255, 0.96);
      --glass: rgba(255, 255, 255, 0.4);
      --radius-lg: 24px;
      --radius-md: 16px;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Poppins', system-ui, sans-serif;
      background: linear-gradient(180deg, var(--soft-pink), #f7f0ff 40%, #eef9ff 100%);
      -webkit-font-smoothing: antialiased;
      min-height: 100vh;
    }

    .container {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
    }

    .card {
      width: 100%;
      max-width: 500px;
      background: var(--card-bg);
      border-radius: var(--radius-lg);
      box-shadow: 0 8px 32px rgba(120, 90, 150, 0.15);
      padding: 24px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.6);
      overflow: hidden;
      position: relative;
    }

    header {
      display: flex; gap: 16px; align-items: center; margin-bottom: 24px;
    }

    .logo .badge {
      width: 52px; height: 52px; border-radius: var(--radius-md);
      background: linear-gradient(135deg, var(--purple), var(--pink));
      display: flex; align-items: center; justify-content: center;
      color: white; font-family: 'Great Vibes', cursive; font-size: 26px;
    }

    h1 { font-size: 20px; color: var(--dark-purple); font-weight: 600; line-height: 1.3; }
    .muted { color: #6a4b7f; font-size: 13px; }

    .view { transition: opacity 0.5s ease, transform 0.5s ease; }
    .view.hidden { opacity: 0; transform: translateY(15px); pointer-events: none; position: absolute; width: 100%; }

    input[type=text], .btn {
      border-radius: 12px; padding: 14px 16px; font-size: 16px;
    }

    input[type=text] {
      width: 100%;
      border: 1px solid rgba(142, 111, 183, 0.2);
      background: rgba(245, 240, 255, 0.6);
      color: var(--dark-purple);
    }
    input[type=text]:focus { outline: none; border-color: var(--purple); }

    .btn {
      background: linear-gradient(90deg, var(--purple), var(--pink));
      color: white; border: 0; font-weight: 600; cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn.secondary {
      background: transparent; border: 1px solid rgba(120, 80, 140, 0.2); color: var(--purple);
    }

    .greeting h2 {
      font-family: 'Great Vibes', cursive;
      font-size: 48px;
      color: var(--purple);
    }

    .poem { color: var(--text-color); font-size: 16px; line-height: 1.7; margin: 16px 0; }

    canvas {
      max-width: 100%;
      height: auto;
      display: block;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(100, 60, 120, 0.1);
    }

    @media (min-width:768px){
      .card{max-width:960px;padding:40px;}
      .greeting h2{font-size:64px;}
    }
  </style>
</head>
<body>

  <div class="container">
    <div class="card">
      <header>
        <div class="logo"><div class="badge">A</div></div>
        <div>
          <h1>Hari ini bunga-bunga tersenyum untukmu, Ataa 🌷</h1>
          <div class="muted">Setiap langkahmu adalah puisi, dan wisuda ini — bait terindah dalam kisahmu.</div>
        </div>
      </header>

      <main class="view landing" id="landing">
        <p style="color:#5c3b77">Masukkan namamu dan klik "Lanjutkan"</p>
        <div class="input-row" style="display:flex;flex-direction:column;gap:12px;">
          <input id="nameInput" type="text" placeholder="Tulis nama..." value="Ataa" />
          <button class="btn" id="enterBtn">Lanjutkan</button>
        </div>
      </main>

      <section class="view home hidden" id="home">
        <div class="greeting">
          <h2 id="heroName">Untuk: Ataa</h2>
          <div class="poem" id="poem"></div>
        </div>
        <div>
          <label class="muted">Unggah foto</label>
          <input id="photoFile" type="file" accept="image/*" />
          <div class="thumb" id="thumb" style="margin:12px 0;">Preview</div>
        </div>
        <canvas id="cardCanvas" width="800" height="466"></canvas>
        <div style="margin-top:16px;display:flex;flex-direction:column;gap:10px;">
          <button id="downloadJpg" class="btn">Unduh Kartu (JPG)</button>
          <button id="resetPic" class="btn secondary">Reset Foto</button>
          <button id="backBtn" class="btn secondary">Kembali</button>
        </div>
        <footer style="margin-top:16px;font-size:12px;color:#6a4b7f;">Abil, Yogyakarta, 16 Oct 2025</footer>
      </section>
    </div>
  </div>

  <script>
    const landing = document.getElementById('landing');
    const home = document.getElementById('home');
    const nameInput = document.getElementById('nameInput');
    const enterBtn = document.getElementById('enterBtn');
    const heroName = document.getElementById('heroName');
    const poemEl = document.getElementById('poem');
    const photoFile = document.getElementById('photoFile');
    const thumb = document.getElementById('thumb');
    const cardCanvas = document.getElementById('cardCanvas');
    const ctx = cardCanvas.getContext('2d');
    let uploadedImage = null;

    const poemTemplate = (name) =>
      `Selamat wisuda, ${name}! 💐\n\nHari ini bukan akhir perjalanan, tapi awal dari mimpi yang terbang tinggi.\n\nSemoga setiap langkahmu dihiasi keberanian, cinta, dan kebahagiaan.\n\nDunia menunggu sinarmu, dan hari ini semuanya dimulai dari senyummu. ✨`;

    function switchView(show, hide) {
      hide.classList.add('hidden');
      setTimeout(() => {
        hide.style.display = 'none';
        show.style.display = 'flex';
        setTimeout(() => show.classList.remove('hidden'), 50);
      }, 400);
    }

    enterBtn.addEventListener('click', () => {
      const name = nameInput.value.trim() || 'Ataa';
      switchView(home, landing);
      heroName.textContent = `Untuk: ${name}`;
      typePoem(poemTemplate(name));
      drawCard(name);
    });

    document.getElementById('backBtn').addEventListener('click', () => {
      switchView(landing, home);
    });

    function typePoem(text) {
      poemEl.textContent = '';
      let i = 0;
      const speed = 25;
      function step() {
        if (i < text.length) {
          poemEl.textContent += text.charAt(i++);
          setTimeout(step, speed);
        }
      }
      step();
    }

    photoFile.addEventListener('change', (e) => {
      const f = e.target.files[0];
      if (!f) return;
      const reader = new FileReader();
      reader.onload = (ev) => {
        const img = new Image();
        img.onload = () => {
          uploadedImage = img;
          thumb.innerHTML = `<img src="${img.src}" alt="Preview" style="width:100px;border-radius:8px;">`;
          setTimeout(() => drawCard(nameInput.value.trim() || 'Ataa'), 100);
        };
        img.src = ev.target.result;
      };
      reader.readAsDataURL(f);
    });

    document.getElementById('resetPic').addEventListener('click', () => {
      uploadedImage = null;
      thumb.textContent = 'Preview';
      photoFile.value = '';
      drawCard(nameInput.value.trim() || 'Ataa');
    });

    function resizeCanvas() {
      const ratio = 700 / 1200;
      const width = Math.min(window.innerWidth * 0.9, 1000);
      cardCanvas.width = width;
      cardCanvas.height = width * ratio;
      drawCard(nameInput.value.trim() || 'Ataa');
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    function drawCard(name) {
      const w = cardCanvas.width;
      const h = cardCanvas.height;
      ctx.clearRect(0, 0, w, h);

      const grad = ctx.createLinearGradient(0, 0, w, h);
      grad.addColorStop(0, '#fff9ff');
      grad.addColorStop(1, '#f4faff');
      ctx.fillStyle = grad;
      ctx.fillRect(0, 0, w, h);

      let textX = w / 2, textAlign = 'center';

      if (uploadedImage) {
        const imgMaxW = w * 0.4, imgMaxH = h * 0.75;
        let imgW = uploadedImage.width, imgH = uploadedImage.height;
        const ratio = Math.min(imgMaxW / imgW, imgMaxH / imgH);
        imgW *= ratio; imgH *= ratio;
        const imgX = 80, imgY = (h - imgH) / 2;
        ctx.save();
        ctx.shadowColor = 'rgba(142, 111, 183, 0.2)';
        ctx.shadowBlur = 25;
        ctx.shadowOffsetX = 5;
        ctx.shadowOffsetY = 10;
        roundClip(ctx, imgX, imgY, imgW, imgH, 20);
        ctx.drawImage(uploadedImage, imgX, imgY, imgW, imgH);
        ctx.restore();
        textX = imgX + imgW + 60;
        textAlign = 'left';
      }

      ctx.textAlign = textAlign;
      ctx.fillStyle = '#5a2d6b';
      ctx.font = '48px "Great Vibes", cursive';
      const titleY = uploadedImage ? h * 0.35 : h * 0.4;
      ctx.fillText(`Untuk ${name},`, textX, titleY);

      ctx.fillStyle = '#4a2f5a';
      ctx.font = '18px Poppins';
      wrapText(ctx, `Hari ini bukan akhir, tapi awal dari mimpi yang mulai terbang. Langit tersenyum melihat langkahmu, ${name}. Semoga langkahmu selalu dihiasi keberanian dan cinta.`, textX, titleY + 50, uploadedImage ? w - textX - 40 : 500, 30);

      ctx.fillStyle = 'rgba(120, 70, 160, 0.7)';
      ctx.font = '20px "Great Vibes", cursive';
      ctx.textAlign = 'center';
      ctx.fillText('✨ Langit ikut tersenyum atas langkah barumu ✨', w / 2, h - 30);
    }

    document.getElementById('downloadJpg').addEventListener('click', () => {
      const name = (nameInput.value.trim() || 'Ataa').replace(/\s+/g, '_');
      try {
        const dataUrl = cardCanvas.toDataURL('image/jpeg', 0.95);
        const link = document.createElement('a');
        if (typeof link.download !== 'undefined') {
          link.href = dataUrl;
          link.download = `kartu-wisuda-${name}.jpg`;
          document.body.appendChild(link);
          setTimeout(() => {
            link.click();
            document.body.removeChild(link);
          }, 100);
        } else {
          window.open(dataUrl, '_blank');
        }
      } catch (e) {
        alert('Gagal mengunduh kartu. Silakan coba di browser lain.');
        console.error(e);
      }
    });

    function roundClip(ctx, x, y, w, h, r) {
      ctx.beginPath();
      ctx.moveTo(x + r, y);
      ctx.arcTo(x + w, y, x + w, y + h, r);
      ctx.arcTo(x + w, y + h, x, y + h, r);
      ctx.arcTo(x, y + h, x, y, r);
      ctx.arcTo(x, y, x + w, y, r);
      ctx.closePath();
      ctx.clip();
    }

    function wrapText(ctx, text, x, y, maxWidth, lineHeight) {
      const words = text.split(' ');
      let line = '';
      for (let n = 0; n < words.length; n++) {
        const testLine = line + words[n] + ' ';
        if (ctx.measureText(testLine).width > maxWidth && n > 0) {
          ctx.fillText(line, x, y);
          line = words[n] + ' ';
          y += lineHeight;
        } else {
          line = testLine;
        }
      }
      ctx.fillText(line, x, y);
    }
  </script>
</body>
</html>
