<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kartu Ucapan Wisuda Interaktif</title>
  <meta name="description" content="Ucapan wisuda interaktif dengan nama custom, pesan puitis, musik piano, dan upload foto yang bisa disimpan menjadi satu file HTML.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
  <style>
    :root{
      --pink: #ffb6c1;
      --blue: #c3bafc;
      --purple: #d8b4fe;
      --card-bg: rgba(255, 255, 255, 0.75);
      --text-dark: #553c78;
      --text-muted: #6b5b95;
      --glass-shadow: 0 18px 50px rgba(142, 112, 255, 0.15);
      --radius: 22px;
    }
    *{box-sizing:border-box}
    @keyframes shimmer {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    html,body{
      height:100%;
      margin:0;
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(300deg, #fdf4f6, #f4f2ff, #fbf8ff);
      background-size: 200% 200%;
      animation: shimmer 20s ease infinite;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .wrap{
      width:94%;
      max-width:980px;
      min-height:640px;
      border-radius:var(--radius);
      background:var(--card-bg);
      backdrop-filter:blur(12px);
      -webkit-backdrop-filter:blur(12px);
      box-shadow:var(--glass-shadow);
      position:relative;
      overflow:hidden;
      padding:28px;
      border: 1px solid rgba(255,255,255,0.4);
    }
    .page{width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;transition:opacity .5s ease, transform .5s ease}
    .page.hidden{opacity:0;transform:scale(.98);pointer-events:none;position:absolute}
    .fade-in-up {
      animation: fadeInUp 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
      opacity: 0;
    }
    @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }
    h1{margin:6px 0;font-size:clamp(28px, 5vw, 40px);color:var(--text-dark);letter-spacing:0.2px}
    h2{margin:6px 0;font-size:clamp(18px, 4vw, 22px);color:var(--text-muted);font-weight:400}
    p.lead{color:var(--text-muted);max-width:680px;text-align:center}
    .name-box{margin-top:24px;display:flex;gap:10px;align-items:center}
    input.name{padding:14px 20px;border-radius:999px;border:1px solid rgba(107,61,142,0.08);min-width:280px;font-size:16px;transition:box-shadow .2s}
    input.name:focus{box-shadow: 0 0 0 3px var(--purple); outline:none;}
    button.enter{padding:14px 22px;border-radius:999px;background:linear-gradient(90deg,var(--pink),var(--blue));border:none;color:white;font-weight:600;cursor:pointer;transition:transform .2s}
    button.enter:hover{transform:scale(1.05)}
    .home-inner{display:grid;grid-template-columns:1fr 380px;gap:28px;align-items:center;width:100%;padding:18px}
    .card-message{padding:28px;border-radius:16px;background:linear-gradient(180deg,rgba(255,255,255,0.6),rgba(255,255,255,0.45));box-shadow:0 10px 30px rgba(120,90,220,0.06)}
    #homeName { font-family: 'Dancing Script', cursive; color: var(--pink); font-size: clamp(32px, 5vw, 48px); margin-bottom: 12px;}
    .poetic{font-size:18px;color:var(--text-dark);line-height:1.8;min-height:160px;transition: background .3s;}
    .poetic[contenteditable="true"] { background: rgba(255,255,255,0.7); border-radius: 8px; padding: 10px; box-shadow: inset 0 1px 4px rgba(0,0,0,0.05); outline-color: var(--purple);}
    .right-panel{padding:18px;border-radius:16px;background:linear-gradient(180deg,rgba(255,255,255,0.55),rgba(255,255,255,0.5));min-height:320px;display:flex;flex-direction:column;align-items:center;justify-content:center}
    .flower-scene{position:relative;width:100%;height:320px;border-radius:12px;overflow:hidden}
    .blob{position:absolute;border-radius:50%;filter:blur(24px);mix-blend-mode:multiply;opacity:0.8}
    .blob.pink{background:var(--pink);width:240px;height:240px;left:-40px;top:10px}
    .blob.blue{background:var(--blue);width:200px;height:200px;right:-20px;top:40px}
    .blob.purple{background:var(--purple);width:180px;height:180px;left:60px;bottom:-40px}
    svg.flower{position:absolute;width:160px;height:160px;transform-origin:center bottom;bottom:20px;left:40px;opacity:0.95;filter:drop-shadow(0 8px 20px rgba(120,90,220,0.08))}
    svg.flower.f2{left:auto;right:36px;bottom:18px;width:140px;height:140px}
    svg.flower.f3{left:110px;bottom:60px;width:120px;height:120px}
    .bloom{transform:scale(0.8);opacity:0.85;transition:transform .9s cubic-bezier(.2,.9,.3,1), opacity .7s}
    .bloom.show{transform:scale(1);opacity:1}
    .controls{display:flex;gap:12px;margin-top:20px;flex-wrap:wrap;}
    button.ctrl{padding:10px 16px;border-radius:999px;border:1px solid rgba(107,61,142,0.08);cursor:pointer;background:#fff;color:var(--text-dark);font-weight:600;display:flex;align-items:center;gap:8px;transition: all .2s;}
    button.ctrl:hover{transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0,0,0,0.05);}
    button.ctrl.primary {background:linear-gradient(90deg,var(--pink),var(--blue));color:#fff;border:none;}
    .modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(18,12,30,0.6);backdrop-filter:blur(5px);opacity:0;pointer-events:none;transition:opacity .3s;z-index: 100;}
    .modal.show{opacity:1;pointer-events:auto}
    .modal .box{width:92%;max-width:680px;background:linear-gradient(180deg,#fff,#fdf8ff);padding:24px;border-radius:12px;box-shadow:0 20px 60px rgba(12,8,40,0.35);text-align:center; transform: scale(0.95); transition: transform .3s cubic-bezier(0.2, 0.9, 0.3, 1.2);}
    .modal.show .box {transform: scale(1);}
    .modal img{width:100%; max-height: 70vh; object-fit: contain; border-radius:8px; margin-block: 12px;}
    .close-modal-btn{margin-top:12px;padding:10px 16px;border-radius:10px;background:#fff;border:1px solid rgba(107,61,142,0.1);cursor:pointer; font-weight: 600; color: var(--text-muted);}
    footer{position:absolute;left:18px;bottom:12px;font-size:12px;color:#927fa8}
    @media (max-width:900px){.home-inner{grid-template-columns:1fr;}.right-panel{order:-1}}
    @media (max-width:480px){.name-box{flex-direction:column;width:100%}.name-box > * {width:100%}}
  </style>
</head>
<body>
  <div class="wrap" id="app">
    <main>
      <section class="page" id="landing">
        <h1 class="fade-in-up">Kartu Ucapan Wisuda</h1>
        <h2 class="fade-in-up" style="animation-delay: 0.1s;">Sebuah Kenangan Interaktif</h2>
        <p class="lead fade-in-up" style="animation-delay: 0.2s;">Masukkan namamu untuk membuat ucapan personal dengan efek cat air, bunga mekar, musik piano, dan foto kenanganmu.</p>
        <div class="name-box fade-in-up" style="animation-delay: 0.3s;">
          <input class="name" id="inputName" placeholder="Tulis nama di sini..." maxlength="40">
          <button class="enter" id="enterBtn">Buat Kartu</button>
        </div>
        <p class="fade-in-up" style="animation-delay: 0.4s; margin-top:14px;color:var(--text-muted);font-size:13px">Atau buka dengan URL: <code>?name=Namamu</code></p>
      </section>

      <section class="page hidden" id="home">
        <div class="home-inner">
          <div class="card-message">
            <h1 id="homeTitle" class="fade-in-up">ðŸŽ“ Selamat Wisuda!</h1>
            <h2 id="homeName" class="fade-in-up" style="animation-delay: 0.2s;">Untukmu yang Hebat</h2>
            <p class="poetic fade-in-up" id="poem" style="animation-delay: 0.4s;"></p>
            <div class="controls fade-in-up" style="animation-delay: 0.6s;">
              <button class="ctrl primary" id="playBtn" aria-label="Putar Musik">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
                <span id="playBtnText">Musik</span>
              </button>
              <button class="ctrl" id="photoBtn" aria-label="Lihat Foto">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path><circle cx="12" cy="13" r="4"></circle></svg>
                Foto
              </button>
              <button class="ctrl" id="changePoemBtn" aria-label="Ganti Pesan">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="17 1 21 5 17 9"></polyline><path d="M3 11V9a4 4 0 0 1 4-4h14"></path><polyline points="7 23 3 19 7 15"></polyline><path d="M21 13v2a4 4 0 0 1-4 4H3"></path></svg>
                Ganti Pesan
              </button>
              <button class="ctrl" id="downloadBtn" aria-label="Simpan Kartu">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                Simpan Kartu
              </button>
            </div>
          </div>
          <div class="right-panel">
            <div class="flower-scene">
              <div class="blob pink"></div><div class="blob blue"></div><div class="blob purple"></div>
              <svg class="flower f1 bloom" viewBox="0 0 120 120"><g><ellipse cx="60" cy="70" rx="40" ry="30" fill="rgba(255,182,193,0.95)"/><ellipse cx="60" cy="70" rx="28" ry="22" fill="rgba(255,226,240,0.95)"/><circle cx="60" cy="60" r="8" fill="#ffd166"/></g></svg>
              <svg class="flower f2 bloom" viewBox="0 0 120 120"><g><ellipse cx="60" cy="62" rx="36" ry="28" fill="rgba(195,186,252,0.95)"/><ellipse cx="60" cy="62" rx="22" ry="16" fill="rgba(235,235,255,0.95)"/><circle cx="60" cy="54" r="7" fill="#ffd166"/></g></svg>
              <svg class="flower f3 bloom" viewBox="0 0 120 120"><g><ellipse cx="60" cy="66" rx="32" ry="24" fill="rgba(216,180,254,0.95)"/><ellipse cx="60" cy="66" rx="20" ry="14" fill="rgba(255,245,250,0.95)"/><circle cx="60" cy="56" r="6" fill="#ffd166"/></g></svg>
            </div>
          </div>
        </div>
        <footer id="footer-home">Tips: Klik area pesan untuk menulis ucapan custom. Tekan "Simpan Kartu" untuk mengunduh file ini.</footer>
      </section>
    </main>

    <div class="modal" id="modal">
      <div class="box">
        <h3>Foto Kenangan</h3>
        <p style="color:var(--text-muted);font-size:14px; margin-top: 4px;">Upload foto dari perangkatmu. Foto ini akan ikut tersimpan jika kamu mengunduh kartu ini.</p>
        <img id="photoImg" src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='800' height='500'><rect width='100%' height='100%' fill='%23f8f5ff'/><text x='50%' y='48%' dominant-baseline='middle' text-anchor='middle' fill='%23725f88' font-size='26' font-family='Poppins, sans-serif'>Foto Wisuda</text><text x='50%' y='58%' dominant-baseline='middle' text-anchor='middle' fill='%23aaa' font-size='14' font-family='Poppins, sans-serif'>Upload fotomu di sini</text></svg>" alt="Foto wisuda placeholder"/>
        <div style="margin-top:14px;display:flex;gap:10px;justify-content:center;align-items:center">
          <label style="background:linear-gradient(90deg,var(--pink),var(--blue));color:#fff;padding:10px 16px;border-radius:10px;cursor:pointer;font-weight:600">
            Pilih Foto<input type="file" id="fileInput" accept="image/*" style="display:none">
          </label>
          <button class="close-modal-btn" id="closeModal">Tutup</button>
        </div>
      </div>
    </div>
  </div>

  <script>
  (() => {
    // --- DOM Elements ---
    const dom = {
      landing: document.getElementById('landing'),
      home: document.getElementById('home'),
      inputName: document.getElementById('inputName'),
      enterBtn: document.getElementById('enterBtn'),
      homeName: document.getElementById('homeName'),
      poem: document.getElementById('poem'),
      playBtn: document.getElementById('playBtn'),
      playBtnText: document.getElementById('playBtnText'),
      photoBtn: document.getElementById('photoBtn'),
      changePoemBtn: document.getElementById('changePoemBtn'),
      downloadBtn: document.getElementById('downloadBtn'),
      modal: document.getElementById('modal'),
      closeModal: document.getElementById('closeModal'),
      photoImg: document.getElementById('photoImg'),
      fileInput: document.getElementById('fileInput'),
      blooms: document.querySelectorAll('.bloom')
    };

    // --- State ---
    const state = {
      audioContext: null,
      isPlaying: false,
      currentPoemIndex: 0,
      userName: 'Sahabatku'
    };

    // --- Data ---
    const poeticMessages = [
      "Di hari ini, kau adalah bukaan musimâ€”kelopak yang mekar, menumpahkan warna dan harap ke dunia. Langkahmu membuka jalan baru; biarkan setiap jejak menjadi taman yang dikenang.",
      "Toga ini bukan akhir, melainkan gerbang. Selamat atas pencapaian luar biasa. Dunia menanti karyamu, pikiranmu, dan semangatmu yang tak pernah padam. Terbanglah tinggi!",
      "Setiap buku yang terbaca, setiap malam tanpa tidur, kini terbayar lunas. Selamat wisuda! Semoga ilmu yang kau dapat menjadi lentera, menerangi jalanmu dan sekitarmu.",
      "Lembayung senja di kampus menjadi saksi. Kini kau siap menyongsong fajar baru. Selamat atas gelar barumu. Jadilah hebat, jadilah inspirasi, jadilah dirimu sendiri.",
      "Klik di sini untuk menulis pesan custom..."
    ];

    // --- Functions ---
    const showHome = (name) => {
      state.userName = name;
      dom.landing.classList.add('hidden');
      dom.home.classList.remove('hidden');
      dom.homeName.textContent = `Untukmu, ${name}!`;
      dom.blooms.forEach((el, i) => {
        setTimeout(() => el.classList.add('show'), 300 + i * 180);
      });
    };
    
    const updatePoem = () => {
      state.currentPoemIndex = (state.currentPoemIndex + 1) % poeticMessages.length;
      const currentPoem = poeticMessages[state.currentPoemIndex];
      dom.poem.textContent = currentPoem;
      
      const isCustom = state.currentPoemIndex === poeticMessages.length - 1;
      dom.poem.contentEditable = isCustom;
      if (isCustom) {
        dom.poem.focus();
      }
    };
    
    const playMusic = async () => {
        if (state.audioContext) return;
        state.isPlaying = true;
        updatePlayButton();
        try {
            state.audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const ctx = state.audioContext;

            // Simple Reverb
            const createReverb = (seconds) => {
                const len = ctx.sampleRate * seconds;
                const buf = ctx.createBuffer(2, len, ctx.sampleRate);
                for (let c = 0; c < 2; c++) {
                    const data = buf.getChannelData(c);
                    for (let i = 0; i < len; i++) {
                        data[i] = (Math.random() * 2 - 1) * Math.pow(1 - i / len, 2.5);
                    }
                }
                return buf;
            };

            const convolver = ctx.createConvolver();
            convolver.buffer = createReverb(1.5);
            const masterGain = ctx.createGain();
            masterGain.gain.value = 0.9;
            const reverbGain = ctx.createGain();
            reverbGain.gain.value = 0.2;
            
            masterGain.connect(ctx.destination);
            reverbGain.connect(convolver);
            convolver.connect(ctx.destination);

            const scheduleNote = (freq, when, dur) => {
                const osc = ctx.createOscillator(); osc.type = 'sine'; osc.frequency.setValueAtTime(freq, when);
                const gain = ctx.createGain(); gain.gain.setValueAtTime(0, when);
                gain.gain.linearRampToValueAtTime(0.8, when + 0.01);
                gain.gain.exponentialRampToValueAtTime(0.0001, when + dur);

                osc.connect(gain);
                gain.connect(masterGain);
                gain.connect(reverbGain);
                osc.start(when);
                osc.stop(when + dur);
            };

            const notes = [329.63, 261.63, 392.00, 329.63, 392.00, 329.63, 523.25, 392.00, 440.00, 329.63, 261.63, 329.63, 392.00, 493.88, 440.00, 392.00];
            const baseDur = 0.8;
            let time = ctx.currentTime + 0.1;
            
            for (let r = 0; r < 5; r++) { // loop for longer music
                for (const note of notes) {
                    scheduleNote(note, time, baseDur);
                    time += baseDur * 0.7;
                }
            }
        } catch (e) {
            console.error("Web Audio API error:", e);
            stopMusic();
        }
    };

    const stopMusic = () => {
      if (state.audioContext) {
        state.audioContext.close().then(() => {
          state.audioContext = null;
          state.isPlaying = false;
          updatePlayButton();
        });
      }
    };
    
    const updatePlayButton = () => {
        if(state.isPlaying) {
            dom.playBtnText.textContent = 'Jeda';
            dom.playBtn.querySelector('svg').innerHTML = `<rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect>`;
        } else {
            dom.playBtnText.textContent = 'Musik';
            dom.playBtn.querySelector('svg').innerHTML = `<polygon points="5 3 19 12 5 21 5 3"></polygon>`;
        }
    };
    
    const handlePhotoUpload = (e) => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = (event) => {
        dom.photoImg.src = event.target.result;
      };
      reader.readAsDataURL(file);
    };
    
    const downloadCard = () => {
        const currentHTML = document.documentElement.outerHTML;
        const parser = new DOMParser();
        const doc = parser.parseFromString(currentHTML, 'text/html');

        // Update content in the new document
        doc.getElementById('homeName').textContent = dom.homeName.textContent;
        doc.getElementById('poem').textContent = dom.poem.textContent;
        doc.getElementById('photoImg').src = dom.photoImg.src;
        
        // Ensure the home page is visible in the saved file
        doc.getElementById('landing').classList.add('hidden');
        doc.getElementById('home').classList.remove('hidden');

        // Clean up interactive elements that are not needed in the final file
        const downloadButtonInDoc = doc.getElementById('downloadBtn');
        if (downloadButtonInDoc) downloadButtonInDoc.remove();
        const footerInDoc = doc.getElementById('footer-home');
        if (footerInDoc) footerInDoc.textContent = `Kartu ucapan dibuat untuk ${state.userName}.`;


        const finalHTML = doc.documentElement.outerHTML;
        const blob = new Blob([finalHTML], { type: 'text/html' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `kartu-wisuda-untuk-${state.userName.replace(/\s+/g, '-')}.html`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    };
    
    // --- Event Listeners ---
    const init = () => {
      dom.enterBtn.addEventListener('click', () => {
        const name = dom.inputName.value.trim();
        showHome(name || 'Sahabatku');
      });
      
      dom.inputName.addEventListener('keyup', (e) => {
        if (e.key === 'Enter') dom.enterBtn.click();
      });

      dom.playBtn.addEventListener('click', () => {
        state.isPlaying ? stopMusic() : playMusic();
      });

      dom.photoBtn.addEventListener('click', () => dom.modal.classList.add('show'));
      dom.closeModal.addEventListener('click', () => dom.modal.classList.remove('show'));
      dom.modal.addEventListener('click', (e) => {
          if (e.target === dom.modal) dom.modal.classList.remove('show');
      });


      dom.fileInput.addEventListener('change', handlePhotoUpload);
      dom.changePoemBtn.addEventListener('click', updatePoem);
      dom.downloadBtn.addEventListener('click', downloadCard);

      // Check for URL param
      const urlParams = new URLSearchParams(window.location.search);
      const nameFromUrl = urlParams.get('name');
      if (nameFromUrl) {
        showHome(decodeURIComponent(nameFromUrl));
      }
      
      // Set initial poem
      dom.poem.textContent = poeticMessages[0];
    };
    
    // --- Start the App ---
    init();
  })();
  </script>
</body>
</html>
